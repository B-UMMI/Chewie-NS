{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport { all, call, cancelled, put, select, takeEvery } from 'redux-saga/effects';\nimport { FETCH_CANCEL, FETCH_END, FETCH_ERROR, FETCH_START } from '../actions';\nimport { fetchActionsWithRecordResponse, fetchActionsWithArrayOfIdentifiedRecordsResponse, fetchActionsWithArrayOfRecordsResponse, fetchActionsWithTotalResponse, sanitizeFetchType } from '../core';\n\nfunction validateResponseFormat(response, type, logger // eslint-disable-line no-console\n) {\n  if (logger === void 0) {\n    logger = console.error;\n  }\n\n  if (!response.hasOwnProperty('data')) {\n    logger(\"The response to '\" + type + \"' must be like { data: ... }, but the received response does not have a 'data' key. The dataProvider is probably wrong for '\" + type + \"'.\");\n    throw new Error('ra.notification.data_provider_error');\n  }\n\n  if (fetchActionsWithArrayOfRecordsResponse.includes(type) && !Array.isArray(response.data)) {\n    logger(\"The response to '\" + type + \"' must be like { data : [...] }, but the received data is not an array. The dataProvider is probably wrong for '\" + type + \"'\");\n    throw new Error('ra.notification.data_provider_error');\n  }\n\n  if (fetchActionsWithArrayOfIdentifiedRecordsResponse.includes(type) && Array.isArray(response.data) && response.data.length > 0 && response.data.some(function (d) {\n    return !d.hasOwnProperty('id');\n  })) {\n    logger(\"The response to '\" + type + \"' must be like { data : [{ id: 123, ...}, ...] }, but at least one received data item do not have an 'id' key. The dataProvider is probably wrong for '\" + type + \"'\");\n    throw new Error('ra.notification.data_provider_error');\n  }\n\n  if (fetchActionsWithRecordResponse.includes(type) && !response.data.hasOwnProperty('id')) {\n    logger(\"The response to '\" + type + \"' must be like { data: { id: 123, ... } }, but the received data does not have an 'id' key. The dataProvider is probably wrong for '\" + type + \"'\");\n    throw new Error('ra.notification.data_provider_error');\n  }\n\n  if (fetchActionsWithTotalResponse.includes(type) && !response.hasOwnProperty('total')) {\n    logger(\"The response to '\" + type + \"' must be like  { data: [...], total: 123 }, but the received response does not have a 'total' key. The dataProvider is probably wrong for '\" + type + \"'\");\n    throw new Error('ra.notification.data_provider_error');\n  }\n}\n\nexport function handleFetch(dataProvider, action) {\n  var type, payload, _a, fetchMeta, onSuccess, onFailure, meta, restType, successSideEffects, failureSideEffects, isOptimistic, response, error_1;\n\n  return __generator(this, function (_b) {\n    switch (_b.label) {\n      case 0:\n        type = action.type, payload = action.payload, _a = action.meta, fetchMeta = _a.fetch, onSuccess = _a.onSuccess, onFailure = _a.onFailure, meta = __rest(_a, [\"fetch\", \"onSuccess\", \"onFailure\"]);\n        restType = fetchMeta;\n        successSideEffects = onSuccess instanceof Function ? {} : onSuccess;\n        failureSideEffects = onFailure instanceof Function ? {} : onFailure;\n        _b.label = 1;\n\n      case 1:\n        _b.trys.push([1, 7, 10, 14]);\n\n        return [4\n        /*yield*/\n        , select(function (state) {\n          return state.admin.ui.optimistic;\n        })];\n\n      case 2:\n        isOptimistic = _b.sent();\n\n        if (isOptimistic) {\n          // in optimistic mode, all fetch actions are canceled,\n          // so the admin uses the store without synchronization\n          return [2\n          /*return*/\n          ];\n        }\n\n        return [4\n        /*yield*/\n        , all([put({\n          type: type + \"_LOADING\",\n          payload: payload,\n          meta: meta\n        }), put({\n          type: FETCH_START\n        })])];\n\n      case 3:\n        _b.sent();\n\n        return [4\n        /*yield*/\n        , call(dataProvider[sanitizeFetchType(restType)], meta.resource, payload)];\n\n      case 4:\n        response = _b.sent();\n\n        if (process.env.NODE_ENV !== 'production') {\n          validateResponseFormat(response, restType);\n        }\n\n        return [4\n        /*yield*/\n        , put({\n          type: type + \"_SUCCESS\",\n          payload: response,\n          requestPayload: payload,\n          meta: __assign(__assign(__assign({}, meta), successSideEffects), {\n            fetchResponse: restType,\n            fetchStatus: FETCH_END\n          })\n        })];\n\n      case 5:\n        _b.sent();\n\n        return [4\n        /*yield*/\n        , put({\n          type: FETCH_END\n        })];\n\n      case 6:\n        _b.sent();\n\n        return [3\n        /*break*/\n        , 14];\n\n      case 7:\n        error_1 = _b.sent();\n        return [4\n        /*yield*/\n        , put({\n          type: type + \"_FAILURE\",\n          error: error_1.message ? error_1.message : error_1,\n          payload: error_1.body ? error_1.body : null,\n          requestPayload: payload,\n          meta: __assign(__assign(__assign({}, meta), failureSideEffects), {\n            fetchResponse: restType,\n            fetchStatus: FETCH_ERROR\n          })\n        })];\n\n      case 8:\n        _b.sent();\n\n        return [4\n        /*yield*/\n        , put({\n          type: FETCH_ERROR,\n          error: error_1\n        })];\n\n      case 9:\n        _b.sent();\n\n        return [3\n        /*break*/\n        , 14];\n\n      case 10:\n        return [4\n        /*yield*/\n        , cancelled()];\n\n      case 11:\n        if (!_b.sent()) return [3\n        /*break*/\n        , 13];\n        return [4\n        /*yield*/\n        , put({\n          type: FETCH_CANCEL\n        })];\n\n      case 12:\n        _b.sent();\n\n        return [2\n        /*return*/\n        ];\n\n      case 13:\n        return [7\n        /*endfinally*/\n        ];\n\n      case 14:\n        return [2\n        /*return*/\n        ];\n    }\n  });\n}\nexport var takeFetchAction = function (action) {\n  return action.meta && action.meta.fetch;\n};\n\nvar fetch = function (dataProvider) {\n  return function watchFetch() {\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , takeEvery(takeFetchAction, handleFetch, dataProvider)];\n\n        case 1:\n          _a.sent();\n\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  };\n};\n\nexport default fetch;","map":{"version":3,"sources":["/node_modules/ra-core/esm/sideEffect/fetch.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__generator","thisArg","body","_","label","sent","trys","ops","f","y","g","next","verb","Symbol","iterator","v","step","op","TypeError","done","value","pop","push","e","__rest","indexOf","getOwnPropertySymbols","propertyIsEnumerable","all","cancelled","put","select","takeEvery","FETCH_CANCEL","FETCH_END","FETCH_ERROR","FETCH_START","fetchActionsWithRecordResponse","fetchActionsWithArrayOfIdentifiedRecordsResponse","fetchActionsWithArrayOfRecordsResponse","fetchActionsWithTotalResponse","sanitizeFetchType","validateResponseFormat","response","type","logger","console","error","Error","includes","Array","isArray","data","some","d","handleFetch","dataProvider","action","payload","_a","fetchMeta","onSuccess","onFailure","meta","restType","successSideEffects","failureSideEffects","isOptimistic","error_1","_b","fetch","Function","state","admin","ui","optimistic","resource","process","env","NODE_ENV","requestPayload","fetchResponse","fetchStatus","message","takeFetchAction","watchFetch"],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport { all, call, cancelled, put, select, takeEvery, } from 'redux-saga/effects';\nimport { FETCH_CANCEL, FETCH_END, FETCH_ERROR, FETCH_START } from '../actions';\nimport { fetchActionsWithRecordResponse, fetchActionsWithArrayOfIdentifiedRecordsResponse, fetchActionsWithArrayOfRecordsResponse, fetchActionsWithTotalResponse, sanitizeFetchType, } from '../core';\nfunction validateResponseFormat(response, type, logger // eslint-disable-line no-console\n) {\n    if (logger === void 0) { logger = console.error; }\n    if (!response.hasOwnProperty('data')) {\n        logger(\"The response to '\" + type + \"' must be like { data: ... }, but the received response does not have a 'data' key. The dataProvider is probably wrong for '\" + type + \"'.\");\n        throw new Error('ra.notification.data_provider_error');\n    }\n    if (fetchActionsWithArrayOfRecordsResponse.includes(type) &&\n        !Array.isArray(response.data)) {\n        logger(\"The response to '\" + type + \"' must be like { data : [...] }, but the received data is not an array. The dataProvider is probably wrong for '\" + type + \"'\");\n        throw new Error('ra.notification.data_provider_error');\n    }\n    if (fetchActionsWithArrayOfIdentifiedRecordsResponse.includes(type) &&\n        Array.isArray(response.data) &&\n        response.data.length > 0 &&\n        response.data.some(function (d) { return !d.hasOwnProperty('id'); })) {\n        logger(\"The response to '\" + type + \"' must be like { data : [{ id: 123, ...}, ...] }, but at least one received data item do not have an 'id' key. The dataProvider is probably wrong for '\" + type + \"'\");\n        throw new Error('ra.notification.data_provider_error');\n    }\n    if (fetchActionsWithRecordResponse.includes(type) &&\n        !response.data.hasOwnProperty('id')) {\n        logger(\"The response to '\" + type + \"' must be like { data: { id: 123, ... } }, but the received data does not have an 'id' key. The dataProvider is probably wrong for '\" + type + \"'\");\n        throw new Error('ra.notification.data_provider_error');\n    }\n    if (fetchActionsWithTotalResponse.includes(type) &&\n        !response.hasOwnProperty('total')) {\n        logger(\"The response to '\" + type + \"' must be like  { data: [...], total: 123 }, but the received response does not have a 'total' key. The dataProvider is probably wrong for '\" + type + \"'\");\n        throw new Error('ra.notification.data_provider_error');\n    }\n}\nexport function handleFetch(dataProvider, action) {\n    var type, payload, _a, fetchMeta, onSuccess, onFailure, meta, restType, successSideEffects, failureSideEffects, isOptimistic, response, error_1;\n    return __generator(this, function (_b) {\n        switch (_b.label) {\n            case 0:\n                type = action.type, payload = action.payload, _a = action.meta, fetchMeta = _a.fetch, onSuccess = _a.onSuccess, onFailure = _a.onFailure, meta = __rest(_a, [\"fetch\", \"onSuccess\", \"onFailure\"]);\n                restType = fetchMeta;\n                successSideEffects = onSuccess instanceof Function ? {} : onSuccess;\n                failureSideEffects = onFailure instanceof Function ? {} : onFailure;\n                _b.label = 1;\n            case 1:\n                _b.trys.push([1, 7, 10, 14]);\n                return [4 /*yield*/, select(function (state) { return state.admin.ui.optimistic; })];\n            case 2:\n                isOptimistic = _b.sent();\n                if (isOptimistic) {\n                    // in optimistic mode, all fetch actions are canceled,\n                    // so the admin uses the store without synchronization\n                    return [2 /*return*/];\n                }\n                return [4 /*yield*/, all([\n                        put({ type: type + \"_LOADING\", payload: payload, meta: meta }),\n                        put({ type: FETCH_START }),\n                    ])];\n            case 3:\n                _b.sent();\n                return [4 /*yield*/, call(dataProvider[sanitizeFetchType(restType)], meta.resource, payload)];\n            case 4:\n                response = _b.sent();\n                if (process.env.NODE_ENV !== 'production') {\n                    validateResponseFormat(response, restType);\n                }\n                return [4 /*yield*/, put({\n                        type: type + \"_SUCCESS\",\n                        payload: response,\n                        requestPayload: payload,\n                        meta: __assign(__assign(__assign({}, meta), successSideEffects), { fetchResponse: restType, fetchStatus: FETCH_END }),\n                    })];\n            case 5:\n                _b.sent();\n                return [4 /*yield*/, put({ type: FETCH_END })];\n            case 6:\n                _b.sent();\n                return [3 /*break*/, 14];\n            case 7:\n                error_1 = _b.sent();\n                return [4 /*yield*/, put({\n                        type: type + \"_FAILURE\",\n                        error: error_1.message ? error_1.message : error_1,\n                        payload: error_1.body ? error_1.body : null,\n                        requestPayload: payload,\n                        meta: __assign(__assign(__assign({}, meta), failureSideEffects), { fetchResponse: restType, fetchStatus: FETCH_ERROR }),\n                    })];\n            case 8:\n                _b.sent();\n                return [4 /*yield*/, put({ type: FETCH_ERROR, error: error_1 })];\n            case 9:\n                _b.sent();\n                return [3 /*break*/, 14];\n            case 10: return [4 /*yield*/, cancelled()];\n            case 11:\n                if (!_b.sent()) return [3 /*break*/, 13];\n                return [4 /*yield*/, put({ type: FETCH_CANCEL })];\n            case 12:\n                _b.sent();\n                return [2 /*return*/];\n            case 13: return [7 /*endfinally*/];\n            case 14: return [2 /*return*/];\n        }\n    });\n}\nexport var takeFetchAction = function (action) { return action.meta && action.meta.fetch; };\nvar fetch = function (dataProvider) {\n    return function watchFetch() {\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, takeEvery(takeFetchAction, handleFetch, dataProvider)];\n                case 1:\n                    _a.sent();\n                    return [2 /*return*/];\n            }\n        });\n    };\n};\nexport default fetch;\n"]},"metadata":{},"sourceType":"module"}