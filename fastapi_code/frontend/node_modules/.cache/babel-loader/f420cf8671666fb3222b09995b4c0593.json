{"ast":null,"code":"import decodeJwt from 'jwt-decode';\nconst authProvider = {\n  login: ({\n    username,\n    password\n  }) => {\n    let formData = new FormData();\n    formData.append('username', username);\n    formData.append('password', password);\n    const request = new Request('/api/token', {\n      method: 'POST',\n      body: formData\n    });\n    return fetch(request).then(response => {\n      if (response.status < 200 || response.status >= 300) {\n        throw new Error(response.statusText);\n      }\n\n      return response.json();\n    }).then(({\n      access_token\n    }) => {\n      const decodedToken = decodeJwt(access_token);\n\n      if (decodedToken.permissions !== 'admin') {\n        throw new Error('Forbidden');\n      }\n\n      localStorage.setItem('token', access_token);\n      localStorage.setItem('permissions', decodedToken.permissions);\n    });\n  },\n  logout: () => {\n    localStorage.removeItem('token');\n    localStorage.removeItem('permissions');\n    return Promise.resolve();\n  },\n  checkError: error => {\n    const status = error.status;\n\n    if (status === 401 || status === 403) {\n      localStorage.removeItem('token');\n      return Promise.reject();\n    }\n\n    return Promise.resolve();\n  },\n  checkAuth: () => localStorage.getItem('token') ? Promise.resolve() : Promise.reject(),\n  getPermissions: () => {\n    const role = localStorage.getItem('permissions');\n    return role ? Promise.resolve(role) : Promise.reject(); // localStorage.getItem('token') ? Promise.resolve() : Promise.reject(),\n  }\n};\nexport default authProvider;","map":{"version":3,"sources":["/app/src/admin/authProvider.ts"],"names":["decodeJwt","authProvider","login","username","password","formData","FormData","append","request","Request","method","body","fetch","then","response","status","Error","statusText","json","access_token","decodedToken","permissions","localStorage","setItem","logout","removeItem","Promise","resolve","checkError","error","reject","checkAuth","getItem","getPermissions","role"],"mappings":"AAAA,OAAOA,SAAP,MAAsB,YAAtB;AAOA,MAAMC,YAAY,GAAG;AACnBC,EAAAA,KAAK,EAAE,CAAC;AAAEC,IAAAA,QAAF;AAAYC,IAAAA;AAAZ,GAAD,KAA2C;AAChD,QAAIC,QAAQ,GAAG,IAAIC,QAAJ,EAAf;AACAD,IAAAA,QAAQ,CAACE,MAAT,CAAgB,UAAhB,EAA4BJ,QAA5B;AACAE,IAAAA,QAAQ,CAACE,MAAT,CAAgB,UAAhB,EAA4BH,QAA5B;AACA,UAAMI,OAAO,GAAG,IAAIC,OAAJ,CAAY,YAAZ,EAA0B;AACxCC,MAAAA,MAAM,EAAE,MADgC;AAExCC,MAAAA,IAAI,EAAEN;AAFkC,KAA1B,CAAhB;AAIA,WAAOO,KAAK,CAACJ,OAAD,CAAL,CACJK,IADI,CACEC,QAAD,IAAc;AAClB,UAAIA,QAAQ,CAACC,MAAT,GAAkB,GAAlB,IAAyBD,QAAQ,CAACC,MAAT,IAAmB,GAAhD,EAAqD;AACnD,cAAM,IAAIC,KAAJ,CAAUF,QAAQ,CAACG,UAAnB,CAAN;AACD;;AACD,aAAOH,QAAQ,CAACI,IAAT,EAAP;AACD,KANI,EAOJL,IAPI,CAOC,CAAC;AAAEM,MAAAA;AAAF,KAAD,KAAsB;AAC1B,YAAMC,YAAiB,GAAGpB,SAAS,CAACmB,YAAD,CAAnC;;AACA,UAAIC,YAAY,CAACC,WAAb,KAA6B,OAAjC,EAA0C;AACxC,cAAM,IAAIL,KAAJ,CAAU,WAAV,CAAN;AACD;;AACDM,MAAAA,YAAY,CAACC,OAAb,CAAqB,OAArB,EAA8BJ,YAA9B;AACAG,MAAAA,YAAY,CAACC,OAAb,CAAqB,aAArB,EAAoCH,YAAY,CAACC,WAAjD;AACD,KAdI,CAAP;AAeD,GAxBkB;AAyBnBG,EAAAA,MAAM,EAAE,MAAM;AACZF,IAAAA,YAAY,CAACG,UAAb,CAAwB,OAAxB;AACAH,IAAAA,YAAY,CAACG,UAAb,CAAwB,aAAxB;AACA,WAAOC,OAAO,CAACC,OAAR,EAAP;AACD,GA7BkB;AA8BnBC,EAAAA,UAAU,EAAGC,KAAD,IAA+B;AACzC,UAAMd,MAAM,GAAGc,KAAK,CAACd,MAArB;;AACA,QAAIA,MAAM,KAAK,GAAX,IAAkBA,MAAM,KAAK,GAAjC,EAAsC;AACpCO,MAAAA,YAAY,CAACG,UAAb,CAAwB,OAAxB;AACA,aAAOC,OAAO,CAACI,MAAR,EAAP;AACD;;AACD,WAAOJ,OAAO,CAACC,OAAR,EAAP;AACD,GArCkB;AAsCnBI,EAAAA,SAAS,EAAE,MACTT,YAAY,CAACU,OAAb,CAAqB,OAArB,IAAgCN,OAAO,CAACC,OAAR,EAAhC,GAAoDD,OAAO,CAACI,MAAR,EAvCnC;AAwCnBG,EAAAA,cAAc,EAAE,MAAM;AACpB,UAAMC,IAAI,GAAGZ,YAAY,CAACU,OAAb,CAAqB,aAArB,CAAb;AACA,WAAOE,IAAI,GAAGR,OAAO,CAACC,OAAR,CAAgBO,IAAhB,CAAH,GAA2BR,OAAO,CAACI,MAAR,EAAtC,CAFoB,CAGpB;AACD;AA5CkB,CAArB;AA+CA,eAAe7B,YAAf","sourcesContent":["import decodeJwt from 'jwt-decode';\n\ntype loginFormType = {\n  username: string;\n  password: string;\n};\n\nconst authProvider = {\n  login: ({ username, password }: loginFormType) => {\n    let formData = new FormData();\n    formData.append('username', username);\n    formData.append('password', password);\n    const request = new Request('/api/token', {\n      method: 'POST',\n      body: formData,\n    });\n    return fetch(request)\n      .then((response) => {\n        if (response.status < 200 || response.status >= 300) {\n          throw new Error(response.statusText);\n        }\n        return response.json();\n      })\n      .then(({ access_token }) => {\n        const decodedToken: any = decodeJwt(access_token);\n        if (decodedToken.permissions !== 'admin') {\n          throw new Error('Forbidden');\n        }\n        localStorage.setItem('token', access_token);\n        localStorage.setItem('permissions', decodedToken.permissions);\n      });\n  },\n  logout: () => {\n    localStorage.removeItem('token');\n    localStorage.removeItem('permissions');\n    return Promise.resolve();\n  },\n  checkError: (error: { status: number }) => {\n    const status = error.status;\n    if (status === 401 || status === 403) {\n      localStorage.removeItem('token');\n      return Promise.reject();\n    }\n    return Promise.resolve();\n  },\n  checkAuth: () =>\n    localStorage.getItem('token') ? Promise.resolve() : Promise.reject(),\n  getPermissions: () => {\n    const role = localStorage.getItem('permissions');\n    return role ? Promise.resolve(role) : Promise.reject();\n    // localStorage.getItem('token') ? Promise.resolve() : Promise.reject(),\n  },\n};\n\nexport default authProvider;\n"]},"metadata":{},"sourceType":"module"}