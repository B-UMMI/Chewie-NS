{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport { FETCH_END, REFRESH_VIEW } from '../../../actions';\nimport { CREATE, DELETE, DELETE_MANY, GET_LIST, GET_MANY, GET_MANY_REFERENCE, GET_ONE, UPDATE, UPDATE_MANY } from '../../../core';\nvar initialState = {};\n\nvar validityReducer = function (previousState, _a) {\n  if (previousState === void 0) {\n    previousState = initialState;\n  }\n\n  var type = _a.type,\n      payload = _a.payload,\n      requestPayload = _a.requestPayload,\n      meta = _a.meta;\n\n  if (type === REFRESH_VIEW) {\n    return initialState;\n  }\n\n  if (!meta || !meta.fetchResponse || meta.fetchStatus !== FETCH_END || meta.fromCache === true) {\n    return previousState;\n  }\n\n  if (payload.validUntil) {\n    // store the validity date\n    switch (meta.fetchResponse) {\n      case GET_LIST:\n      case GET_MANY:\n      case GET_MANY_REFERENCE:\n        return addIds(payload.data.map(function (record) {\n          return record.id;\n        }), payload.validUntil, previousState);\n\n      case UPDATE_MANY:\n        return addIds(payload.data, payload.validUntil, previousState);\n\n      case UPDATE:\n      case CREATE:\n      case GET_ONE:\n        return addIds([payload.data.id], payload.validUntil, previousState);\n\n      case DELETE:\n      case DELETE_MANY:\n        throw new Error('Responses to dataProvider.delete() or dataProvider.deleteMany() should not contain a validUntil param');\n\n      default:\n        return previousState;\n    }\n  } else {\n    // remove the validity date\n    switch (meta.fetchResponse) {\n      case GET_LIST:\n      case GET_MANY:\n      case GET_MANY_REFERENCE:\n        return removeIds(payload.data.map(function (record) {\n          return record.id;\n        }), previousState);\n\n      case UPDATE:\n      case CREATE:\n      case GET_ONE:\n        return removeIds([payload.data.id], previousState);\n\n      case UPDATE_MANY:\n        return removeIds(payload.data, previousState);\n\n      case DELETE:\n        return removeIds([requestPayload.id], previousState);\n\n      case DELETE_MANY:\n        return removeIds(requestPayload.ids, previousState);\n\n      default:\n        return previousState;\n    }\n  }\n};\n\nvar addIds = function (ids, validUntil, oldValidityRegistry) {\n  if (ids === void 0) {\n    ids = [];\n  }\n\n  var validityRegistry = __assign({}, oldValidityRegistry);\n\n  ids.forEach(function (id) {\n    validityRegistry[id] = validUntil;\n  });\n  return validityRegistry;\n};\n\nvar removeIds = function (ids, oldValidityRegistry) {\n  if (ids === void 0) {\n    ids = [];\n  }\n\n  var validityRegistry = __assign({}, oldValidityRegistry);\n\n  ids.forEach(function (id) {\n    delete validityRegistry[id];\n  });\n  return validityRegistry;\n};\n\nexport default validityReducer;","map":{"version":3,"sources":["/node_modules/ra-core/esm/reducer/admin/resource/validity.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","FETCH_END","REFRESH_VIEW","CREATE","DELETE","DELETE_MANY","GET_LIST","GET_MANY","GET_MANY_REFERENCE","GET_ONE","UPDATE","UPDATE_MANY","initialState","validityReducer","previousState","_a","type","payload","requestPayload","meta","fetchResponse","fetchStatus","fromCache","validUntil","addIds","data","map","record","id","Error","removeIds","ids","oldValidityRegistry","validityRegistry","forEach"],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { FETCH_END, REFRESH_VIEW } from '../../../actions';\nimport { CREATE, DELETE, DELETE_MANY, GET_LIST, GET_MANY, GET_MANY_REFERENCE, GET_ONE, UPDATE, UPDATE_MANY, } from '../../../core';\nvar initialState = {};\nvar validityReducer = function (previousState, _a) {\n    if (previousState === void 0) { previousState = initialState; }\n    var type = _a.type, payload = _a.payload, requestPayload = _a.requestPayload, meta = _a.meta;\n    if (type === REFRESH_VIEW) {\n        return initialState;\n    }\n    if (!meta ||\n        !meta.fetchResponse ||\n        meta.fetchStatus !== FETCH_END ||\n        meta.fromCache === true) {\n        return previousState;\n    }\n    if (payload.validUntil) {\n        // store the validity date\n        switch (meta.fetchResponse) {\n            case GET_LIST:\n            case GET_MANY:\n            case GET_MANY_REFERENCE:\n                return addIds(payload.data.map(function (record) { return record.id; }), payload.validUntil, previousState);\n            case UPDATE_MANY:\n                return addIds(payload.data, payload.validUntil, previousState);\n            case UPDATE:\n            case CREATE:\n            case GET_ONE:\n                return addIds([payload.data.id], payload.validUntil, previousState);\n            case DELETE:\n            case DELETE_MANY:\n                throw new Error('Responses to dataProvider.delete() or dataProvider.deleteMany() should not contain a validUntil param');\n            default:\n                return previousState;\n        }\n    }\n    else {\n        // remove the validity date\n        switch (meta.fetchResponse) {\n            case GET_LIST:\n            case GET_MANY:\n            case GET_MANY_REFERENCE:\n                return removeIds(payload.data.map(function (record) { return record.id; }), previousState);\n            case UPDATE:\n            case CREATE:\n            case GET_ONE:\n                return removeIds([payload.data.id], previousState);\n            case UPDATE_MANY:\n                return removeIds(payload.data, previousState);\n            case DELETE:\n                return removeIds([requestPayload.id], previousState);\n            case DELETE_MANY:\n                return removeIds(requestPayload.ids, previousState);\n            default:\n                return previousState;\n        }\n    }\n};\nvar addIds = function (ids, validUntil, oldValidityRegistry) {\n    if (ids === void 0) { ids = []; }\n    var validityRegistry = __assign({}, oldValidityRegistry);\n    ids.forEach(function (id) {\n        validityRegistry[id] = validUntil;\n    });\n    return validityRegistry;\n};\nvar removeIds = function (ids, oldValidityRegistry) {\n    if (ids === void 0) { ids = []; }\n    var validityRegistry = __assign({}, oldValidityRegistry);\n    ids.forEach(function (id) {\n        delete validityRegistry[id];\n    });\n    return validityRegistry;\n};\nexport default validityReducer;\n"]},"metadata":{},"sourceType":"module"}