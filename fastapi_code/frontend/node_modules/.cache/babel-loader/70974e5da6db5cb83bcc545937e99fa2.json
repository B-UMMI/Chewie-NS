{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport isEqual from 'lodash/isEqual';\nimport { FETCH_END } from '../../../actions';\nimport { CREATE, DELETE, DELETE_MANY, GET_LIST, GET_MANY, GET_MANY_REFERENCE, GET_ONE, UPDATE, UPDATE_MANY } from '../../../core';\nimport getFetchedAt from '../../../util/getFetchedAt';\n/**\n * Make the fetchedAt property non enumerable\n */\n\nexport var hideFetchedAt = function (records) {\n  Object.defineProperty(records, 'fetchedAt', {\n    enumerable: false,\n    configurable: false,\n    writable: false\n  });\n  return records;\n};\n/**\n * Add new records to the pool, and remove outdated ones.\n *\n * This is the equivalent of a stale-while-revalidate caching strategy:\n * The cached data is displayed before fetching, and stale data is removed\n * only once fresh data is fetched.\n */\n\nexport var addRecordsAndRemoveOutdated = function (newRecords, oldRecords) {\n  if (newRecords === void 0) {\n    newRecords = [];\n  }\n\n  var newRecordsById = {};\n  newRecords.forEach(function (record) {\n    return newRecordsById[record.id] = record;\n  });\n  var newFetchedAt = getFetchedAt(newRecords.map(function (_a) {\n    var id = _a.id;\n    return id;\n  }), oldRecords.fetchedAt);\n  var records = {\n    fetchedAt: newFetchedAt\n  };\n  Object.keys(newFetchedAt).forEach(function (id) {\n    return records[id] = newRecordsById[id] ? isEqual(newRecordsById[id], oldRecords[id]) ? oldRecords[id] // do not change the record to avoid a redraw\n    : newRecordsById[id] : oldRecords[id];\n  });\n  return hideFetchedAt(records);\n};\n/**\n * Add new records to the pool, without touching the other ones.\n */\n\nexport var addRecords = function (newRecords, oldRecords) {\n  if (newRecords === void 0) {\n    newRecords = [];\n  }\n\n  var newRecordsById = __assign({}, oldRecords);\n\n  newRecords.forEach(function (record) {\n    newRecordsById[record.id] = isEqual(record, oldRecords[record.id]) ? oldRecords[record.id] : record;\n  });\n  var updatedFetchedAt = getFetchedAt(newRecords.map(function (_a) {\n    var id = _a.id;\n    return id;\n  }), oldRecords.fetchedAt);\n  Object.defineProperty(newRecordsById, 'fetchedAt', {\n    value: __assign(__assign({}, oldRecords.fetchedAt), updatedFetchedAt),\n    enumerable: false\n  });\n  return newRecordsById;\n};\nexport var addOneRecord = function (newRecord, oldRecords, date) {\n  var _a, _b;\n\n  if (date === void 0) {\n    date = new Date();\n  }\n\n  var newRecordsById = __assign(__assign({}, oldRecords), (_a = {}, _a[newRecord.id] = isEqual(newRecord, oldRecords[newRecord.id]) ? oldRecords[newRecord.id] // do not change the record to avoid a redraw\n  : newRecord, _a));\n\n  return Object.defineProperty(newRecordsById, 'fetchedAt', {\n    value: __assign(__assign({}, oldRecords.fetchedAt), (_b = {}, _b[newRecord.id] = date, _b)),\n    enumerable: false\n  });\n};\n\nvar includesNotStrict = function (items, element) {\n  return items.some(function (item) {\n    return item == element;\n  });\n}; // eslint-disable-line eqeqeq\n\n/**\n * Remove records from the pool\n */\n\n\nexport var removeRecords = function (removedRecordIds, oldRecords) {\n  if (removedRecordIds === void 0) {\n    removedRecordIds = [];\n  }\n\n  var records = Object.entries(oldRecords).filter(function (_a) {\n    var key = _a[0];\n    return !includesNotStrict(removedRecordIds, key);\n  }).reduce(function (obj, _a) {\n    var _b;\n\n    var key = _a[0],\n        val = _a[1];\n    return __assign(__assign({}, obj), (_b = {}, _b[key] = val, _b));\n  }, {\n    fetchedAt: {}\n  });\n  records.fetchedAt = Object.entries(oldRecords.fetchedAt).filter(function (_a) {\n    var key = _a[0];\n    return !includesNotStrict(removedRecordIds, key);\n  }).reduce(function (obj, _a) {\n    var _b;\n\n    var key = _a[0],\n        val = _a[1];\n    return __assign(__assign({}, obj), (_b = {}, _b[key] = val, _b));\n  }, {});\n  return hideFetchedAt(records);\n};\nvar initialState = hideFetchedAt({\n  fetchedAt: {}\n});\n\nvar dataReducer = function (previousState, _a) {\n  if (previousState === void 0) {\n    previousState = initialState;\n  }\n\n  var payload = _a.payload,\n      meta = _a.meta;\n\n  if (meta && meta.optimistic) {\n    if (meta.fetch === UPDATE) {\n      var updatedRecord = __assign(__assign({}, previousState[payload.id]), payload.data);\n\n      return addOneRecord(updatedRecord, previousState);\n    }\n\n    if (meta.fetch === UPDATE_MANY) {\n      var updatedRecords = payload.ids.map(function (id) {\n        return __assign(__assign({}, previousState[id]), payload.data);\n      });\n      return addRecordsAndRemoveOutdated(updatedRecords, previousState);\n    }\n\n    if (meta.fetch === DELETE) {\n      return removeRecords([payload.id], previousState);\n    }\n\n    if (meta.fetch === DELETE_MANY) {\n      return removeRecords(payload.ids, previousState);\n    }\n  }\n\n  if (!meta || !meta.fetchResponse || meta.fetchStatus !== FETCH_END) {\n    return previousState;\n  }\n\n  switch (meta.fetchResponse) {\n    case GET_LIST:\n      return addRecordsAndRemoveOutdated(payload.data, previousState);\n\n    case GET_MANY:\n    case GET_MANY_REFERENCE:\n      return addRecords(payload.data, previousState);\n\n    case UPDATE:\n    case CREATE:\n    case GET_ONE:\n      return addOneRecord(payload.data, previousState);\n\n    default:\n      return previousState;\n  }\n};\n\nexport var getRecord = function (state, id) {\n  return state[id];\n};\nexport default dataReducer;","map":{"version":3,"sources":["/node_modules/ra-core/esm/reducer/admin/resource/data.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","isEqual","FETCH_END","CREATE","DELETE","DELETE_MANY","GET_LIST","GET_MANY","GET_MANY_REFERENCE","GET_ONE","UPDATE","UPDATE_MANY","getFetchedAt","hideFetchedAt","records","defineProperty","enumerable","configurable","writable","addRecordsAndRemoveOutdated","newRecords","oldRecords","newRecordsById","forEach","record","id","newFetchedAt","map","_a","fetchedAt","keys","addRecords","updatedFetchedAt","value","addOneRecord","newRecord","date","_b","Date","includesNotStrict","items","element","some","item","removeRecords","removedRecordIds","entries","filter","key","reduce","obj","val","initialState","dataReducer","previousState","payload","meta","optimistic","fetch","updatedRecord","data","updatedRecords","ids","fetchResponse","fetchStatus","getRecord","state"],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport isEqual from 'lodash/isEqual';\nimport { FETCH_END } from '../../../actions';\nimport { CREATE, DELETE, DELETE_MANY, GET_LIST, GET_MANY, GET_MANY_REFERENCE, GET_ONE, UPDATE, UPDATE_MANY, } from '../../../core';\nimport getFetchedAt from '../../../util/getFetchedAt';\n/**\n * Make the fetchedAt property non enumerable\n */\nexport var hideFetchedAt = function (records) {\n    Object.defineProperty(records, 'fetchedAt', {\n        enumerable: false,\n        configurable: false,\n        writable: false,\n    });\n    return records;\n};\n/**\n * Add new records to the pool, and remove outdated ones.\n *\n * This is the equivalent of a stale-while-revalidate caching strategy:\n * The cached data is displayed before fetching, and stale data is removed\n * only once fresh data is fetched.\n */\nexport var addRecordsAndRemoveOutdated = function (newRecords, oldRecords) {\n    if (newRecords === void 0) { newRecords = []; }\n    var newRecordsById = {};\n    newRecords.forEach(function (record) { return (newRecordsById[record.id] = record); });\n    var newFetchedAt = getFetchedAt(newRecords.map(function (_a) {\n        var id = _a.id;\n        return id;\n    }), oldRecords.fetchedAt);\n    var records = { fetchedAt: newFetchedAt };\n    Object.keys(newFetchedAt).forEach(function (id) {\n        return (records[id] = newRecordsById[id]\n            ? isEqual(newRecordsById[id], oldRecords[id])\n                ? oldRecords[id] // do not change the record to avoid a redraw\n                : newRecordsById[id]\n            : oldRecords[id]);\n    });\n    return hideFetchedAt(records);\n};\n/**\n * Add new records to the pool, without touching the other ones.\n */\nexport var addRecords = function (newRecords, oldRecords) {\n    if (newRecords === void 0) { newRecords = []; }\n    var newRecordsById = __assign({}, oldRecords);\n    newRecords.forEach(function (record) {\n        newRecordsById[record.id] = isEqual(record, oldRecords[record.id])\n            ? oldRecords[record.id]\n            : record;\n    });\n    var updatedFetchedAt = getFetchedAt(newRecords.map(function (_a) {\n        var id = _a.id;\n        return id;\n    }), oldRecords.fetchedAt);\n    Object.defineProperty(newRecordsById, 'fetchedAt', {\n        value: __assign(__assign({}, oldRecords.fetchedAt), updatedFetchedAt),\n        enumerable: false,\n    });\n    return newRecordsById;\n};\nexport var addOneRecord = function (newRecord, oldRecords, date) {\n    var _a, _b;\n    if (date === void 0) { date = new Date(); }\n    var newRecordsById = __assign(__assign({}, oldRecords), (_a = {}, _a[newRecord.id] = isEqual(newRecord, oldRecords[newRecord.id])\n        ? oldRecords[newRecord.id] // do not change the record to avoid a redraw\n        : newRecord, _a));\n    return Object.defineProperty(newRecordsById, 'fetchedAt', {\n        value: __assign(__assign({}, oldRecords.fetchedAt), (_b = {}, _b[newRecord.id] = date, _b)),\n        enumerable: false,\n    });\n};\nvar includesNotStrict = function (items, element) {\n    return items.some(function (item) { return item == element; });\n}; // eslint-disable-line eqeqeq\n/**\n * Remove records from the pool\n */\nexport var removeRecords = function (removedRecordIds, oldRecords) {\n    if (removedRecordIds === void 0) { removedRecordIds = []; }\n    var records = Object.entries(oldRecords)\n        .filter(function (_a) {\n        var key = _a[0];\n        return !includesNotStrict(removedRecordIds, key);\n    })\n        .reduce(function (obj, _a) {\n        var _b;\n        var key = _a[0], val = _a[1];\n        return (__assign(__assign({}, obj), (_b = {}, _b[key] = val, _b)));\n    }, {\n        fetchedAt: {},\n    });\n    records.fetchedAt = Object.entries(oldRecords.fetchedAt)\n        .filter(function (_a) {\n        var key = _a[0];\n        return !includesNotStrict(removedRecordIds, key);\n    })\n        .reduce(function (obj, _a) {\n        var _b;\n        var key = _a[0], val = _a[1];\n        return (__assign(__assign({}, obj), (_b = {}, _b[key] = val, _b)));\n    }, {});\n    return hideFetchedAt(records);\n};\nvar initialState = hideFetchedAt({ fetchedAt: {} });\nvar dataReducer = function (previousState, _a) {\n    if (previousState === void 0) { previousState = initialState; }\n    var payload = _a.payload, meta = _a.meta;\n    if (meta && meta.optimistic) {\n        if (meta.fetch === UPDATE) {\n            var updatedRecord = __assign(__assign({}, previousState[payload.id]), payload.data);\n            return addOneRecord(updatedRecord, previousState);\n        }\n        if (meta.fetch === UPDATE_MANY) {\n            var updatedRecords = payload.ids.map(function (id) { return (__assign(__assign({}, previousState[id]), payload.data)); });\n            return addRecordsAndRemoveOutdated(updatedRecords, previousState);\n        }\n        if (meta.fetch === DELETE) {\n            return removeRecords([payload.id], previousState);\n        }\n        if (meta.fetch === DELETE_MANY) {\n            return removeRecords(payload.ids, previousState);\n        }\n    }\n    if (!meta || !meta.fetchResponse || meta.fetchStatus !== FETCH_END) {\n        return previousState;\n    }\n    switch (meta.fetchResponse) {\n        case GET_LIST:\n            return addRecordsAndRemoveOutdated(payload.data, previousState);\n        case GET_MANY:\n        case GET_MANY_REFERENCE:\n            return addRecords(payload.data, previousState);\n        case UPDATE:\n        case CREATE:\n        case GET_ONE:\n            return addOneRecord(payload.data, previousState);\n        default:\n            return previousState;\n    }\n};\nexport var getRecord = function (state, id) { return state[id]; };\nexport default dataReducer;\n"]},"metadata":{},"sourceType":"module"}